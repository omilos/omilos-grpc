// User wants to fetch certificates, and credits
syntax = "proto3";
package omilos_grpc;
option go_package = "gitlab.com/omilos/omilos-grpc";

import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

enum ReactionType {
    UNSPECIFIED = 0;
    LIKE = 1;
}

message GetMeRequest {}

message LoginRequest {
    uint64 timestamp = 1;
    bytes signature = 2;
}

message LoginResponse {
    string token = 1;
    google.protobuf.Timestamp expires_at = 2;
    User me = 3;
}

message PostCastRequest {
    string text = 1;
    google.protobuf.StringValue parent = 2;
}

message LikeCastRequest {
    string hash = 1;
}

message LikeCastResponse {}

message GetCastRequest {
    string hash = 1;
}

message GetCastsRequest {
    string stream_id = 1;
    bool next = 2;
    google.protobuf.UInt32Value fid = 3;
    google.protobuf.StringValue username = 4;
    google.protobuf.StringValue parent = 5;
    google.protobuf.StringValue thread = 6;
    google.protobuf.UInt32Value liked_by = 7;
    google.protobuf.BoolValue has_parent = 8;
    bool trending = 9;
    bool me = 10;
}

message GetUserRequest {
    google.protobuf.UInt32Value fid = 1;
    google.protobuf.StringValue username = 2;
}

message Casts {
    repeated Cast casts = 1;
}

message User {
    uint32 fid = 1;
    string username = 2;
    string display_name = 3;
    ProfilePicture profile_picture = 4;
    Profile profile = 5;
    uint32 follower_count = 6;
    uint32 following_count = 7;
}

message Profile {
    string bio = 1;
}

message Cast {
    string hash = 1;
    string thread_hash = 2;
    string parent_hash = 3;
    Author author = 4;
    string text = 5;
    google.protobuf.Timestamp published_at = 6;
    uint64 replies = 7;
    uint64 reactions = 8;
    uint64 recasts = 9; // TODO
    uint64 watches = 10;
    bool recast = 11;
    ViewerContext viewer_context = 12;
}

message ViewerContext {
    bool reacted = 1;
    bool recast = 2;
    bool watched = 3;
}

message Author {
    uint64 fid = 1;
    string username = 2;
    string display_name = 3;
    ProfilePicture profile_picture = 4;
    uint64 follower_count = 5;
    uint64 following_count = 6;
}

message ProfilePicture {
    string url = 1;
    bool verified = 2;
}


service Omilos {
    rpc Login(LoginRequest) returns (LoginResponse) {}
    rpc PostCast(PostCastRequest) returns (Cast) {}
    rpc LikeCast(LikeCastRequest) returns (LikeCastResponse) {}
    rpc GetMe (GetMeRequest) returns (User) {}
    rpc GetUser (GetUserRequest) returns (User) {}
    rpc GetCast (GetCastRequest) returns (Cast) {}
    rpc GetCasts (GetCastsRequest) returns (Casts) {}
}
